{% extends 'base.html' %}
{% block title %}Inventory Management - POS Inventory{% endblock %}

{% block content %}
<div class="dashboard-header">
  <h1>ðŸ“¦ Inventory Management</h1>
  <p>Manage products, prices, and stock levels</p>
</div>

<div class="content-card">
  <h3>Add New Product</h3>
  <form method="POST" action="{{ url_for('add_product') }}" class="product-form">
    <div class="form-grid">
      <div class="form-group">
        <label>Product Name</label>
        <input type="text" name="name" required>
      </div>
      <div class="form-group">
        <label>Selling Price</label>
        <input type="number" name="price" step="0.01" required>
      </div>
      <div class="form-group">
        <label>Cost Price</label>
        <input type="number" name="cost" step="0.01" required>
      </div>
      <div class="form-group">
        <label>Initial Stock</label>
        <input type="number" name="quantity" required>
      </div>
      <div class="form-group">
        <label>Category</label>
        <input type="text" name="category" placeholder="Optional">
      </div>
      <div class="form-group">
        <button type="submit" class="btn btn-success btn-block">Add Product</button>
      </div>
    </div>
  </form>
</div>

<div class="content-card">
  <div class="card-header">
    <h3>Current Inventory</h3>
    <div class="card-actions">
      <input type="text" id="productSearch" placeholder="Search products..." class="search-input">
    </div>
  </div>

  <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price</th>
          <th>Cost</th>
          <th>Stock</th>
          <th>Category</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td>{{ p.id }}</td>
          <td>
            <input type="text" name="name" value="{{ p.name }}" class="inline-edit">
          </td>
          <td>
            <input type="number" step="0.01" name="price" value="{{ p.price }}" class="inline-edit">
          </td>
          <td>
            <input type="number" step="0.01" name="cost" value="{{ p.cost }}" class="inline-edit">
          </td>
          <td>
            <input type="number" name="quantity" value="{{ p.quantity }}" class="inline-edit">
          </td>
          <td>
            <input type="text" name="category" value="{{ p.category }}" class="inline-edit">
          </td>
          <td>
            <span class="stock-status
              {% if p.quantity == 0 %}status-out
              {% elif p.quantity < 10 %}status-low
              {% else %}status-good{% endif %}">
              {% if p.quantity == 0 %}Out of Stock
              {% elif p.quantity < 10 %}Low Stock
              {% else %}In Stock{% endif %}
            </span>
          </td>
          <td>
            <form method="POST" action="{{ url_for('edit_product', id=p.id) }}" style="display:inline">
              <button type="submit" class="btn btn-primary btn-sm">Update</button>
            </form>
            <a href="{{ url_for('delete_product', id=p.id) }}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('Are you sure you want to delete this product?')">
              Delete
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
document.getElementById('productSearch').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.data-table tbody tr');

    rows.forEach(row => {
        const name = row.querySelector('input[name="name"]').value.toLowerCase();
        const category = row.querySelector('input[name="category"]').value.toLowerCase();
        row.style.display =
            name.includes(searchTerm) || category.includes(searchTerm)
            ? ''
            : 'none';
    });
});
</script>
{% endblock %}